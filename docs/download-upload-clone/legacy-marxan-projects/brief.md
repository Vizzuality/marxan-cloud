# Uploading legacy Marxan projects

Users may wish to upload to a Marxan MaPP instance "legacy" Marxan projects.
These include data files used to run Marxan CLI (command line interface)
projects (`.dat` files), alongside geospatial files used to generate these
`.dat` files through offline workflows, for example using desktop GIS or
conservation planning software.

Users could import such projects into a Marxan MaPP instance, in order to, for
example:

- continue working on an existing Marxan project taking advantage of the user
  workflows and data visualization features of the Marxan MaPP platform
- collaborate on a legacy Marxan project which is still being developed, by
  moving it to the Marxan MaPP platform and keeping the project private, while
  giving access to other Marxan MaPP users as contributors
- share a legacy Marxan project broadly, through the Marxan MaPP platform's
  _community_ area, thus contributing to a public archive/showcase of Marxan
  planning projects

The main expected use cases, depending on user intentions and available legacy
data, as well as relevant features available in the Marxan MaPP platform once a
legacy project has been uploaded are outlined in the companion document *[Use
cases and available features](./use-cases-and-available-features.md)*.

## Legacy Marxan projects import in MarxanWeb

For reference, the Python-based [MarxanWeb
platform](https://docs.marxanweb.org/) supports importing legacy Marxan projects
(`.dat` files alongside a matching planning unit grid as shapefile), with the
following restrictions for the imported projects:

- Project features cannot be added or removed
- Showing the project features on the map is not supported
- Zooming to project features on the map is not supported
- Project features have only basic metadata, e.g. simple names and no
  descriptions

## Requirements

### Essential project data

As the Marxan MaPP platform has a core component of data visualization and
mapping, legacy Marxan projects may only be imported if they match some minimum
requirements in terms of geospatial data available:

- _all the input `.dat` files_ **must be provided** (`input.dat`, `pu.dat`,
  `spec.dat`, `puvspr.dat`)

- as a minimum, a _planning unit grid shapefile_ **must be provided**

This will be used in the Marxan MaPP platform as the geospatial "scaffolding"
on which other data is projected.

Each planning unit in the grid shapefile must have a `puid` attribute set to
match the value used in the `pu.dat` input file. This is so that each planning
unit (spatial data) can be matched to the corresponding entry in the `pu.dat`
file.

### Marxan results

Projects that have been extensively developed outside of the Marxan MaPP
platform up to the point of, for example, developing conservation planning
recommendations based on results of the Marxan workflow may wish to also upload
Marxan *output* files to make sure that the solutions shown in the Marxan MaPP
platform match what was generated by the Marxan CLI software and used as
reference for planning interventions.

In these cases, users should have the ability to upload the contents of the
Marxan `output` folder, with the assurance that running Marxan on the imported
project will be disabled in order to prevent historical/archived results from
ever being overwritten.

### Geospatial data

Other spatial data would "unlock" key features of the Marxan MaPP platform:

**Shapefiles of features**

Without these, only presence/absence of each feature in any given planning unit
could be visualized (this data is inferred from `puvspr.dat` and `spec.dat`).

However, although the portion of each planning unit where each given feature can
be found is known from `puvspr.dat`, the exact spatial range of the feature will
be unknown. Therefore, a visual representation of such features can only be a
rough proxy, made up of the spatial union of all the planning units where the
feature is found (that is, of all the planning units linked to the feature in
`puvspr.dat`). Nevertheless, the `amount` property of each `puvspr.dat` row
could be locked to the value provided when the feature is uploaded [*].

The accuracy of pre-run gap data will likewise be dependent on the methods used
to populate the `amount` column of the legacy `puvspr.dat` file: the Marxan MaPP
platform will use `amount` as a proxy of portion of each planning unit covered
by a feature, irrespective of possible metrics such as count of individuals,
feature density and so on.

The absence of detailed feature spatial data will also prevent users from
splitting and intersecting imported features: these will be only usable
verbatim, not in combination with other feature spatial data.

[*] This is normally calculated in the Marxan MaPP platform by intersecting
feature spatial data with planning units, but this logic can be excluded by
recording in a separate column the value of feature `amount` per planning unit
when a legacy project is uploaded.

**Shapefiles of protected areas**

When users can provide a shapefile with the protected areas considered in the
legacy project, these areas can be shown in Marxan MaPP maps, and - if combined
with a threshold for protected status - the default protection status of each
planning unit can be set.

Without spatial data for protected areas, the lock status (lock-in/lock-out) of
each protected area will be set from the imported `pu.dat`, but if users wish to
continue working on the imported project in Marxan MaPP, they won't be able to
rely on protected area data in order to lock protected units in by default.

**Shapefiles of locked-in or locked-out areas**

These are not essential. A proxy to such shapefiles will be created while
importing a legacy project, as spatial union of all the planning unit marked as
locked-in or locked-out, respectively, in the imported `pu.dat` file.

**Cost surface shapefile**

This is not essential. A proxy to such shapefile will be created while importing
a legacy project, from the `cost` property of each planning unit listed in the
imported `pu.dat` file.
