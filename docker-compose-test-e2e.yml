# GH Actions runners on Ubuntu 18.04 require an older (<= 3.6) Compose file version
version: "3.6"
services:
  api-postgresql:
    build:
      context: ./postgresql
      dockerfile: Dockerfile
    container_name: marxan-test-e2e-postgresql-api
    volumes:
      - "./api/test/fixtures:/opt"
    ports:
      - "3542:5432"
    environment:
      - POSTGRES_PASSWORD=marxan-api
      - POSTGRES_USER=marxan-api
      - POSTGRES_DB=marxan-api
    restart: on-failure

  test-e2e-postgresql-geo-api:
    build:
      context: ./postgresql
      dockerfile: Dockerfile
    container_name: marxan-test-e2e-postgresql-geo-api
    ports:
      - "3541:5432"
    environment:
      - POSTGRES_PASSWORD=marxan-geo
      - POSTGRES_USER=marxan-geo
      - POSTGRES_DB=marxan-geo
    restart: on-failure

  test-e2e-redis:
    build:
      context: ./redis
      dockerfile: Dockerfile
    container_name: marxan-test-e2e-redis
    command: [ "redis-server" ]
    ports:
      - "${REDIS_API_SERVICE_PORT}:6379"
    restart: on-failure

volumes:
  marxan-cloud-backend-e2e-temp-storage:
